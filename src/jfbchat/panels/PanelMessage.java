 /* ###########################################################################
  *
  *  JFBChat it's a simple software written in Java that let you int contact
  *  with yours Facebook friends without your browser.
  *  Copyright (C) 2011  Digitex (Giuseppe Federico)
  *
  *  This program is free software: you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation, either version 3 of the License, or
  *  (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  *###########################################################################
  *
  */

package jfbchat.panels;


import java.awt.Color;
import java.util.Date;
import java.text.SimpleDateFormat;

import jfbchat.Contact;

import jfbchat.resources.*;

import jfbchat.debug.DebugMessage;



 /**
 * A JPanel that represent a incoming/sended message in the ChatFrame
 * @author Digitex ( Giuseppe Federico - digitex3d@gmail.com )
 */

public class PanelMessage extends javax.swing.JPanel {

    private final int MAX_DIMENSION = 32767;

    private Date hour = new Date();
    private SimpleDateFormat formatter;
    private String formattedHour;
    private String message;
    private MP3 incomingSnd;
    private MP3 sendSnd;

    private Contact contact;
    private ChatPreferences prefs;
    

    /** Creates new messages form PanelMessage */
    public PanelMessage(boolean send,Contact contact, String message) {
        
        //Time
        this.formatter = new SimpleDateFormat("HH:mm");
        this.formattedHour = formatter.format(hour);

        //Init the JPanel components
        initComponents();

        //Init the chat preferences
        this.prefs = new ChatPreferences();

        this.contact = contact;

        //Load the incoming message sound
        try {

            incomingSnd = new MP3( Snds.INCOMING );
            
        } catch (Exception e)

        {

            new DebugMessage(this.getClass(), "Cannot load" + Snds.INCOMING );

        }

        //Load the sended message sound
        try {

            sendSnd = new MP3( Snds.SENDED );

        } catch (Exception e)

        {

            new DebugMessage(this.getClass(), "Cannot load" + Snds.SENDED );

        }

        this.message = message;

        if (send){

            Labelfromto.setText(formattedHour + " Me: ");
            
            //If SENDED_SOUND is enabled play a sound
            if( prefs.getPreferences().getBoolean( ( Options.SENDED_SOUND ), true ) ){
                sendSnd.play();
            }


        }
        else{
                
            //Set the background color of the jPanelFromTo
            jPanelFromTo.setBackground( Options.RECEIVED_MSG_PANEL_COLOR );

            Labelfromto.setText(formattedHour + " " +contact.getUser() + " says: ");

            //If INCOMING_SOUND is enabled play a sound
             if( prefs.getPreferences().getBoolean( ( Options.INCOMING_SOUND ), true ) ){

                incomingSnd.play();
               
            }
        }
            
            
        //Change the panel text
        LabelText.setText(message);
       
       
        setVisible(true);

    }

    /**
     * This method fix the layout of the message and set the maximum Height
     * @return
     */
    @Override
    public java.awt.Dimension getMaximumSize() {

        int fixed_height = (int) getPreferredSize().getHeight();
        java.awt.Dimension fixedDimension;

        fixedDimension = new java.awt.Dimension( MAX_DIMENSION ,fixed_height);

        return fixedDimension;
        
    }

    public String getMessage(){

        return this.message;

    }

    public Contact getContact(){
        return contact;
    }


    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")


    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jPanelMain = new javax.swing.JPanel();
        jPanelTextField = new javax.swing.JPanel();
        LabelText = new javax.swing.JTextPane();
        jPanelFromTo = new javax.swing.JPanel();
        Labelfromto = new javax.swing.JLabel();

        setBackground(new java.awt.Color(254, 254, 254));
        setAlignmentY(0.0F);
        setLayout(new javax.swing.BoxLayout(this, javax.swing.BoxLayout.Y_AXIS));

        jPanel1.setBackground(new java.awt.Color(255, 255, 255));
        jPanel1.setAlignmentY(0.0F);
        jPanel1.setLayout(new javax.swing.BoxLayout(jPanel1, javax.swing.BoxLayout.Y_AXIS));

        jPanelMain.setBackground(new java.awt.Color(255, 255, 255));
        jPanelMain.setAlignmentY(0.0F);

        jPanelTextField.setBackground(new java.awt.Color(255, 255, 255));
        jPanelTextField.setAlignmentY(0.0F);

        LabelText.setBackground(new java.awt.Color(255, 255, 255));
        LabelText.setEditable(false);
        LabelText.setFont(new java.awt.Font("Verdana", 0, 15)); // NOI18N
        LabelText.setText("Message here");
        LabelText.setAlignmentY(0.0F);

        javax.swing.GroupLayout jPanelTextFieldLayout = new javax.swing.GroupLayout(jPanelTextField);
        jPanelTextField.setLayout(jPanelTextFieldLayout);
        jPanelTextFieldLayout.setHorizontalGroup(
            jPanelTextFieldLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(LabelText, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 134, Short.MAX_VALUE)
        );
        jPanelTextFieldLayout.setVerticalGroup(
            jPanelTextFieldLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(LabelText)
        );

        jPanelFromTo.setBackground(new java.awt.Color(208, 239, 238));
        jPanelFromTo.setAlignmentY(0.0F);

        Labelfromto.setBackground(new java.awt.Color(208, 239, 238));
        Labelfromto.setFont(new java.awt.Font("Verdana", 1, 15)); // NOI18N
        Labelfromto.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        Labelfromto.setText("... say: / me:");
        Labelfromto.setVerticalAlignment(javax.swing.SwingConstants.BOTTOM);
        Labelfromto.setAlignmentY(0.0F);
        Labelfromto.setHorizontalTextPosition(javax.swing.SwingConstants.LEFT);

        javax.swing.GroupLayout jPanelFromToLayout = new javax.swing.GroupLayout(jPanelFromTo);
        jPanelFromTo.setLayout(jPanelFromToLayout);
        jPanelFromToLayout.setHorizontalGroup(
            jPanelFromToLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(Labelfromto, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 134, Short.MAX_VALUE)
        );
        jPanelFromToLayout.setVerticalGroup(
            jPanelFromToLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(Labelfromto)
        );

        javax.swing.GroupLayout jPanelMainLayout = new javax.swing.GroupLayout(jPanelMain);
        jPanelMain.setLayout(jPanelMainLayout);
        jPanelMainLayout.setHorizontalGroup(
            jPanelMainLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanelFromTo, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanelTextField, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        jPanelMainLayout.setVerticalGroup(
            jPanelMainLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanelMainLayout.createSequentialGroup()
                .addComponent(jPanelFromTo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanelTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        );

        jPanel1.add(jPanelMain);

        add(jPanel1);
    }// </editor-fold>//GEN-END:initComponents
    
   
   


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextPane LabelText;
    private javax.swing.JLabel Labelfromto;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanelFromTo;
    private javax.swing.JPanel jPanelMain;
    private javax.swing.JPanel jPanelTextField;
    // End of variables declaration//GEN-END:variables

}
